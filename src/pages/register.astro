---
import BoltForm from "../layouts/bolt_form.astro";
import ButtonForm from "../components/button_form.astro";
import IconButtonForm from "../components/icon_button_form.astro";
import InputForm from "../components/input_form.astro";
import CheckboxForm from "../components/checkbox_form.astro";
import DateBirthSelect from "../components/date_birth_select.astro";

const background_url = "https://previews.123rf.com/images/tovovan/tovovan1703/tovovan170300091/74578597-fondo-de-dise%C3%B1o-de-material-4k-abstracto-moderno-blured-fondo-gris-oscuro-para-el-dise%C3%B1o.jpg";
---

<BoltForm   page_title="Register"
            back_image={`background-image: url('${background_url}')`}
            title="Bolt"
            subtitle="Crear una cuenta">
    
    <InputForm 
        id = "email_inp"
        placeholder="email"
        error="please enter your email"
        label="Email:"
    />   
    
    <InputForm 
        id = "user_inp"
        placeholder="username"
        error="please enter your username"
        label="Username:"
    /> 

    <InputForm 
        id = "pass_inp"
        placeholder="password"
        error="please enter your password"
        label="Password:"
    />   

    <InputForm 
        id = "conf_pass_inp"
        placeholder="password"
        error="password should be the same xd"
        label="Confirm Password:"
    />

    <DateBirthSelect
        text="fecha de nacimiento: "
    />

    <IconButtonForm
        text="Continuar con google"
        imagen="https://play-lh.googleusercontent.com/aFWiT2lTa9CYBpyPjfgfNHd0r5puwKRGj2rHpdPTNrz2N9LXgN_MbLjePd1OTc0E8Rl1=w240-h480-rw"
    />

    <IconButtonForm
        text="Continuar con discord"
        imagen="https://play-lh.googleusercontent.com/aFWiT2lTa9CYBpyPjfgfNHd0r5puwKRGj2rHpdPTNrz2N9LXgN_MbLjePd1OTc0E8Rl1=w240-h480-rw"
    />

    <CheckboxForm
        text="Acepto las condiciones del servicio y la pólitica de privacidad"
        error="debes aceptar las condiciones de servicio >:V"
    />

    <ButtonForm
        id = "submit_register"
        text="submit"
        imagen="https://play-lh.googleusercontent.com/aFWiT2lTa9CYBpyPjfgfNHd0r5puwKRGj2rHpdPTNrz2N9LXgN_MbLjePd1OTc0E8Rl1=w240-h480-rw"
    />
</BoltForm>
<script>
    const email_input = document.getElementById('email_inp');
    const user_input = document.getElementById('user_inp');
    const pass_input = document.getElementById('pass_inp');
    const conf_pass_input = document.getElementById('conf_pass_inp');
    const submit_btn = document.getElementById('submit_register');

    submit_btn?.addEventListener('click', () => {
        //handle_empty_inputs();
        //handle_passwords();
        let email = email_input.value;
        let user = user_input.value;
        let password = pass_input.value;
        register();
    });

    function handle_passwords() {
        //To DO!!!
        console.log('To Do!: handle_passwords()');
    }

    function handle_empty_inputs() {
        //To DO!!!
        console.log('To Do!: handle_empty_inputs()');
    }

    async function register() {
  try {
    const response = await fetch('https://authrest.onrender.com/api/register/', {
      method: 'POST',
      body: JSON.stringify({
        username: "usuariodeprueba1",
        password: "contraseña2",
        email: "correo@correo69.com",
        is_superuser: "false"
      }),
    });

    if (!response.ok) {
      throw new Error(`sopotamadre: ${response.statusText}`);
    }

    const data = await response.json();
    console.log('Registro exitoso:', data);
    // Aquí puedes manejar la respuesta según tus necesidades

  } catch (error) {
    console.error('Suputamadre: ', error);
    // Maneja los errores aquí
  }
}

</script>